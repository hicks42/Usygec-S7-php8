{% extends '@EasyAdmin/crud/form_theme.html.twig' %}

{# Surcharge du label des fieldsets pour forcer les majuscules #}
{% block ea_form_fieldset_open_label %}
    <div class="form-fieldset-header {{ ea_is_collapsible ? 'collapsible' }} {{ ea_help is not empty ? 'with-help' }}">
        <div class="form-fieldset-title">
            {% if ea_is_collapsible %}
                <a href="#content-{{ form.vars.name }}" data-bs-toggle="collapse"
                   class="form-fieldset-title-content form-fieldset-collapse {{ ea_is_collapsed ? 'collapsed' }}"
                   aria-expanded="{{ ea_is_collapsed ? 'false' : 'true' }}" aria-controls="content-{{ form.vars.name }}">
                    {{ ea_form_ealabel(form)|striptags|upper }}
                </a>
            {% else %}
                <span class="not-collapsible form-fieldset-title-content">
                    {{ ea_form_ealabel(form)|striptags|upper }}
                </span>
            {% endif %}

            {% if ea_help %}
                <div class="form-fieldset-help">{{ ea_help|trans|raw }}</div>
            {% endif %}
        </div>
    </div>
{% endblock %}

{# Surcharge du widget de collection pour ajouter un en-tête #}
{% block collection_widget %}
    {% if form.vars.name == 'performances' %}
        {# En-tête pour les performances #}
        <div style="display: flex; gap: 15px; margin-bottom: 10px; padding: 0 10px; font-weight: bold;">
            <div style="flex: 0 0 180px;">Année</div>
            <div style="flex: 0 0 180px;">Taux (%)</div>
            <div style="flex: 0 0 auto; width: 60px;"></div>
        </div>
        {{ parent() }}
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{# Surcharge du rendu de chaque entrée de collection #}
{% block collection_entry_row %}
    {% set field_name = form.parent.vars.name|default('') %}

    {% if field_name == 'performances' %}
        {# Rendu personnalisé pour les performances : tout sur une ligne sans labels #}
        <div class="field-collection-item" style="display: flex; gap: 15px; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 4px;">
            <div style="flex: 0 0 180px;">
                {{ form_widget(form.year) }}
                {{ form_errors(form.year) }}
            </div>
            <div style="flex: 0 0 180px;">
                {{ form_widget(form.rate) }}
                {{ form_errors(form.rate) }}
            </div>
            <div style="flex: 0 0 auto;">
                <button type="button"
                        class="btn btn-sm btn-danger field-collection-item-delete"
                        onclick="this.closest('.field-collection-item').remove()"
                        title="Supprimer">
                    ×
                </button>
            </div>
        </div>
    {% else %}
        {# Utilise le comportement par défaut pour les autres collections #}
        {{ parent() }}
    {% endif %}
{% endblock %}
