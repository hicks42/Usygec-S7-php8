{# Modal intelligente pour trouver et extraire le Google Place ID #}
<div id="pidHelpModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        {# Header #}
        <div class="bg-teal-800 text-white p-6 rounded-t-lg">
            <div class="flex justify-between items-center">
                <h2 class="text-lg font-bold flex items-center gap-2 text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                    </svg>
                    Cr√©ation du lien<br>vers avis Google
                </h2>
                <button type="button" onclick="closePidHelpModal()" class="text-white hover:text-gray-200 text-3xl font-bold leading-none">
                    &times;
                </button>
            </div>
        </div>

        {# Content #}
        <div class="p-1 md:p-2 space-y-6">
            {# √âtape 1 : Ouvrir Google Maps #}
            <div class="border border-green-200 rounded-lg p-1 md:p-5 bg-gradient-to-br from-green-50 to-blue-50">
                <div class="flex items-start gap-3">
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-3">Rechercher sur Google Maps</h3>
                        <p class="text-gray-600 mb-3">Votre √©tablissement : <strong id="establishmentNameDisplay" class="text-blue-800"></strong></p>

                        <div class="space-y-3">
                            <div>
                                <label for="pidActivityType" class="block text-sm font-medium text-gray-700 mb-1">Type d'activit√©</label>
                                <input
                                    type="text"
                                    id="pidActivityType"
                                    placeholder="Ex: Restaurant, H√¥tel, Boulangerie, Coiffeur..."
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                >
                                <p class="text-gray-500 text-xs mt-1">Permet d'afficher une liste de r√©sultats sur Google Maps</p>
                            </div>

                            <button
                                type="button"
                                onclick="openGoogleMapsWithSearch()"
                                class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white px-4 py-3 rounded-lg hover:from-green-700 hover:to-green-800 transition-all font-semibold flex items-center justify-center gap-2 shadow-md"
                            >
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                Ouvrir Google Maps
                            </button>

                            <div class="bg-blue-100 border-l-4 border-blue-500 p-3 text-sm text-gray-700 rounded">
                                <strong>üìç Instructions :</strong>
                                <ul class="mt-2 space-y-1 list-disc list-inside text-xs">
                                    <li>Saisissez le type d'activit√© ci-dessus</li>
                                    <li>Cliquez sur "Ouvrir Google Maps"</li>
                                    <li>Trouvez votre √©tablissement dans la liste de r√©sultats</li>
                                    <li>Faites un <strong>clic droit</strong> sur le nom ‚Üí "Copier l'adresse du lien"</li>
                                    <li>Collez le lien √† l'√©tape 2 ci-dessous</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {# √âtape 2 : Copier le lien depuis Google Maps #}
            <div class="border border-blue-200 rounded-lg p-1 md:p-5 bg-gradient-to-br from-blue-50 to-purple-50">
                <div class="flex items-start gap-3">
                    {# <div class="flex-shrink-0 w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full flex items-center justify-center font-bold text-sm">2</div> #}
                    <div class="flex-1">
                        <h3 class="text-lg font-bold text-gray-700 mb-3">Copier le lien de l'√©tablissement</h3>

                        <div class="space-y-3">

                            <div>
                                <label for="pidUrlInput" class="block text-sm font-medium text-gray-700 mb-1">
                                    Collez le lien Google Maps ici
                                </label>
                                <textarea
                                    id="pidUrlInput"
                                    rows="3"
                                    placeholder="Ex: https://www.google.com/maps/place/... ou https://maps.app.goo.gl/..."
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"
                                ></textarea>
                            </div>

                            {# Affichage du PID extrait #}
                            <div id="pidExtractedResult" class="hidden">
                                <div class="bg-green-100 border border-green-300 rounded-lg p-4">
                                    <p class="text-sm font-medium text-green-800 mb-2">‚úì Place ID trouv√© :</p>
                                    <code id="pidExtractedValue" class="block bg-white px-3 py-2 rounded border border-green-300 text-green-900 font-mono text-sm break-all"></code>
                                </div>
                            </div>

                            {# Message d'erreur #}
                            <div id="pidErrorResult" class="hidden">
                                <div class="bg-red-100 border border-red-300 rounded-lg p-4">
                                    <p class="text-sm font-medium text-red-800">
                                        ‚úó Aucun Place ID trouv√© dans ce lien. V√©rifiez que vous avez bien copi√© le lien depuis le nom de l'√©tablissement sur Google Maps.
                                    </p>
                                </div>
                            </div>

                            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 text-sm text-gray-700 rounded">
                                <strong>üí° Important :</strong> Le lien doit provenir de la page Google Maps de votre √©tablissement. Il sera analys√© automatiquement pour extraire le Place ID.
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {# Note d'aide #}
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded text-sm text-gray-700">
                <p>
                    <strong>Remarque :</strong> Le Place ID est extrait automatiquement du lien que vous collez. Il permet de cr√©er un lien direct vers le formulaire d'avis Google de votre √©tablissement.
                </p>
            </div>
        </div>

        {# Footer #}
        <div class="bg-gray-100 p-4 rounded-b-lg flex justify-between gap-3">
            <button type="button" onclick="closePidHelpModal()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-200 transition-colors font-semibold text-gray-700">
                Annuler
            </button>
            <button
                type="button"
                id="pidConfirmBtn"
                onclick="confirmAndFillPid()"
                disabled
                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold disabled:bg-gray-400 disabled:cursor-not-allowed"
            >
                Utiliser ce Place ID
            </button>
        </div>
    </div>
</div>
