{% extends 'base.html.twig' %}

{% block title %}Modification du compte EZR
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script type="module">
		import '{{ asset('js/collection_managment.js') }}';
    import '{{ asset('js/accordion.js') }}';
	</script>
	<script src="{{ asset('js/pid_help_modal.js') }}" defer></script>
	<script src="{{ asset('js/copy_to_clipboard.js') }}" defer></script>
{% endblock javascripts %}

{% block content %}

	{% import "ezreview/macros/forms.html.twig" as formMacros %}
	<div class="flex flex-col justify-center mt-10 p-2">
		<div class="w-full">
			<h1>Param√®tres de {{ user.company}}</h1>
			<div class="">
				{{ form_start(form, {"method": "PATCH"}) }}
				<div class="flex flex-row rounded overflow-hidden my-3 p-2">
					<div class="w-2/3">
						<div class="me-2">Nom de la soci√©t√© :</div>
						<div>{{ form_row(form.company) }}</div>
					</div>
				</div>
				{# Encadr√© d'explication de la configuration des √©tablissements #}
				<div class="bg-gradient-to-br from-green-50 to-blue-50 border-2 border-green-200 rounded-xl p-2 md:p-6 my-4 shadow-sm">
					<div class="flex items-start gap-3 mb-4">
						<div class="flex-shrink-0">
							<svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
							</svg>
						</div>
						<div class="flex-1">
							<h3 class="text-xl font-bold text-gray-800 mb-2">Configuration de vos √©tablissements</h3>
							<p class="text-gray-700 mb-3">
								Ajoutez et configurez vos √©tablissements, structures ou soci√©t√©s pour g√©rer intelligemment leurs avis clients.
							</p>
						</div>
					</div>

					<div class="bg-white rounded-lg p-4 mb-2 border-l-8 border-blue-500 shadow-sm">
						<h4 class="font-semibold text-blue-800 flex items-center gap-2">
							{# <span>üìã</span> #}Informations √† renseigner pour chaque √©tablissement
						</h4>

						<div class="grid md:grid-cols-2 gap-2">
							{# Informations de base #}
							<div>
								<h5 class="font-semibold text-gray-700 mb-2 text-sm">Informations de base (obligatoires)</h5>
								<ul class="text-sm text-gray-700 space-y-1.5 ml-4">
									<li class="flex items-start gap-2">
										<span class="text-blue-500">‚Ä¢</span>
										<span><strong>Nom</strong> de l'√©tablissement</span>
									</li>
									<li class="flex items-start gap-2">
										<span class="text-blue-500">‚Ä¢</span>
										<span><strong>Adresse compl√®te</strong> (rue, code postal, ville)</span>
									</li>
									<li class="flex items-start gap-2">
										<span class="text-blue-500">‚Ä¢</span>
										<span><strong>Logo/Image</strong> (optionnel)</span>
									</li>
								</ul>
							</div>

							{# Configuration des avis #}
							<div>
								<h5 class="font-semibold text-gray-700 mb-2 text-sm">Configuration des avis</h5>
								<ul class="text-sm text-gray-700 space-y-1.5 ml-4">
									<li class="flex items-start gap-2">
										<span class="text-green-500">‚Ä¢</span>
										<span><strong>Place ID Google</strong> (optionnel) : Lien direct vers Google Review</span>
									</li>
									<li class="flex items-start gap-2">
										<span class="text-orange-500">‚Ä¢</span>
										<span><strong>URL mauvais avis</strong> : Email ou formulaire pour les retours n√©gatifs</span>
									</li>
								</ul>
							</div>
						</div>
					</div>

					{# Fonctionnement du syst√®me #}
					{# <div class="bg-gradient-to-r from-green-100 to-blue-100 rounded-lg p-4">
						<h4 class="font-semibold text-gray-800 mb-2 flex items-center gap-2">
							<span>‚öôÔ∏è</span>
							<span>Comment √ßa fonctionne ensuite ?</span>
						</h4>
						<div class="grid md:grid-cols-3 gap-3 text-sm">
							<div class="bg-white rounded p-3 shadow-sm">
								<div class="font-semibold text-green-700 mb-1 flex items-center gap-1">
									<span>‚ú®</span>
									<span>Avis positifs</span>
								</div>
								<p class="text-gray-600 text-xs">Redirig√©s vers Google Review pour am√©liorer votre note publique</p>
							</div>
							<div class="bg-white rounded p-3 shadow-sm">
								<div class="font-semibold text-orange-700 mb-1 flex items-center gap-1">
									<span>üîí</span>
									<span>Avis n√©gatifs</span>
								</div>
								<p class="text-gray-600 text-xs">Envoy√©s √† votre email priv√© pour gestion proactive</p>
							</div>
							<div class="bg-white rounded p-3 shadow-sm">
								<div class="font-semibold text-blue-700 mb-1 flex items-center gap-1">
									<span>üìä</span>
									<span>R√©sultat</span>
								</div>
								<p class="text-gray-600 text-xs">E-r√©putation prot√©g√©e et clients satisfaits</p>
							</div>
						</div>
					</div> #}

					{# Astuce Place ID #}
					<div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mt-3 rounded">
						<p class="text-sm text-gray-700">
							<strong>üí° Astuce :</strong> Vous n'avez pas le Place ID ? Pas de probl√®me ! Un lien de secours vers Google Maps sera g√©n√©r√© automatiquement avec l'adresse de votre √©tablissement. Le bouton <strong class="text-blue-600">"Trouver le PID"</strong> vous aide √† le r√©cup√©rer facilement.
						</p>
					</div>
				</div>

				<div class="flex flex-col md:flex-row justify-between border-b my-3 p-2">

					<div class="basis-8/12">
						<h1>Etablissements :</h1>
					</div>

					<div class="basis-4/12">
						<button type="button" class="add_item_link btn btn-secondary btn-sm float-end" data-collection-holder-class="structures">
							<i class="fa-solid fa-folder-plus"></i>
							Ajouter</button>
					</div>

				</div>

				{# ici commencent les structures existantes #}
				{% for row in form.structures %}
						{{ formMacros.niceForm(row) }}
				{% endfor %}

				{# ici commencent le form d'ajout de structure #}
				<ul class="structures"
            data-index="{{ form.structures|length > 0 ? form.structures|last.vars.name + 1 : 0 }}"
            data-prototype="{{ formMacros.newForm(form.structures.vars.prototype)|e('html_attr') }}"></ul>

				{% do form.company.setRendered %}
				{% if form.structures|length == 0  %}
					{% do form.structures.setRendered %}
				{% endif %}

				<div class="w-full flex justify-around">
					<a href="{{ path('ezreview_hp') }}" class="flex flex-col btn btn-outline btn-md my-2">
						<i class="fa-solid fa-angles-left"></i>
            <div class="text-gray-600">Retour</div>
						</a>
					<button type="submit" class="btn btn-success btn-sm my-2">
						<i class="fa-solid fa-file-arrow-down"></i>
						Enregistrer
					</button>
				</div>

				{{ form_end(form) }}
			</div>
		</div>
	</div>

	{# Inclure la modal d'aide pour le PID #}
	{% include 'ezreview/partials/_pid_help_modal.html.twig' %}
{% endblock %}
