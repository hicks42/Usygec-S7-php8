{% extends 'base.html.twig' %}

{% block title %}Actions disponibles pour
	{{ user.company}}
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
{% endblock stylesheets %}

{% block javascripts %}
	{{ parent() }}
	<script type="module">
		import '{{ asset('js/modal.js') }}';
	</script>
{% endblock javascripts %}

{% block content %}
	<div class="flex justify-center mt-10">
		<div class="w-full mt-4 p-2">
			<div class="flex justify-between my-3 flex-col md:flex-row">

				<div class="flex justify-start flex-col w-10/12">
					<h1>EZ Review de :
						<span class="font-semibold text-nowrap text-slate-500 text-3xl ms-2">
							{{ user.company}}
						</span>
					</h1>
				</div>

				<div class="w-2/12 align-center me-1">
					<a href="{{ path('ezreview_settings') }}" class="btn btn-secondary btn-sm md:float-end text-nowrap">
						<i class="fa-solid fa-pen-to-square"></i>
						Configurer</a>
				</div>
			</div>

			<div class="flex justify-start border-b">
				<h2>E-mail :
					<span class="text-spartan text-2xl text-slate-500  ms-1">{{user.email}}</span>
				</h2>
			</div>

			{# Encadré d'explication du fonctionnement d'EZReview #}
			<div class="bg-gradient-to-br from-blue-50 to-purple-50 border-2 border-blue-200 rounded-xl p-1 md:p-6 mt-6 shadow-sm">
				<div class="flex items-start gap-3 mb-4">
					<div class="flex-shrink-0">
						<svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
						</svg>
					</div>
					<div class="flex-1">
						<h3 class="text-xl font-bold text-gray-800 mb-2">Comment fonctionne EZReview ?</h3>
						<p class="text-gray-700 mb-3">
							<strong>EZReview</strong> est un système intelligent qui protège votre e-réputation en filtrant les avis clients.
						</p>
					</div>
				</div>

				<div class="grid md:grid-cols-2 gap-4 mb-4">
					{# Avis positifs #}
					<div class="bg-green-100 rounded-lg p-4 border-l-8 border-green-500 shadow-sm">
						<div class="flex items-center gap-2 mb-2">
							<h4 class="font-semibold text-green-700">Avis positifs</h4>
						</div>
						<ul class="text-sm text-gray-700 space-y-1">
							<li class="flex items-start gap-2">
								<span class="text-green-500">→</span>
								<span>Redirection vers <strong>Google Review</strong></span>
							</li>
							<li class="flex items-start gap-2">
								<span class="text-green-500">→</span>
								<span>Avis <strong>public</strong> sur Google Maps</span>
							</li>
							<li class="flex items-start gap-2">
								<span class="text-green-500">→</span>
								<span>Améliore votre <strong>note globale</strong></span>
							</li>
						</ul>
					</div>

					{# Avis négatifs #}
					<div class="bg-orange-100 rounded-lg p-4 border-l-8 border-orange-500 shadow-sm">
						<div class="flex items-center gap-2 mb-2">
							<h4 class="font-semibold text-orange-700">Avis négatifs</h4>
						</div>
						<ul class="text-sm text-gray-700 space-y-1">
							<li class="flex items-start gap-2">
								<span class="text-orange-500">→</span>
								<span>Redirection vers <strong>formulaire privé</strong></span>
							</li>
							<li class="flex items-start gap-2">
								<span class="text-orange-500">→</span>
								<span>Email envoyé à <strong>votre boîte mail</strong></span>
							</li>
							<li class="flex items-start gap-2">
								<span class="text-orange-500">→</span>
								<span>Gestion <strong>privée et proactive</strong></span>
							</li>
						</ul>
					</div>
				</div>

				{# Avantages #}
				<div class="bg-blue-100 rounded-lg p-4">
					<h4 class="font-semibold text-blue-800 mb-2 flex items-center gap-2">
						<span>Résultat</span>
					</h4>
					<div class="grid md:grid-cols-3 gap-3 text-sm text-gray-700">
						<div class="flex items-start gap-2">
							<span class="text-blue-600 font-bold">✓</span>
							<span>E-réputation protégée</span>
						</div>
						<div class="flex items-start gap-2">
							<span class="text-blue-600 font-bold">✓</span>
							<span>Note Google élevée</span>
						</div>
						<div class="flex items-start gap-2">
							<span class="text-blue-600 font-bold">✓</span>
							<span>Clients récupérés</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="flex flex-row rounded overflow-hidden justify-center p-2">
		<div class="card w-full my-4 p-3">
			<h3>Etablissements:</h3>
			<ul class="structures">
				{% for structure in user.structures %}
					<li>
						<hr>
						<div class="flex flex-col xl:flex-row justify-around items-center m-1">
							<div class="flex flex-col items-center xl:w-5/12">
								<i class="fa-solid fa-building lead my-2"></i>
								{{ structure.name }}
							</div>
							<div class="flex flex-col sm:flex-row text-nowrap justify-around w-full xl:w-7/12 my-3 gap-3">
								<a href="{{ path('enquete', {'id': structure.id}) }}" class="btn btn-secondary btn-sm mx-1">
									<i class="fa-regular fa-envelope lead "></i><br>
									Envoyer mail</a>

								<a href="#" type="button" data-modal-type="email-csv" data-structureid="{{structure.id}}" class="modal-btn btn btn-secondary btn-sm mx-1 hidden md:block">
									<i class="fa-regular fa-file-lines lead"></i><br>
									Envois groupé
								</a>

								<a href="{{ path('qr_gen', {id: structure.id}) }}" type="button" data-structureid="{{structure.id}}" class="qrcode-btn btn btn-secondary btn-sm mx-1">
									<i class="fa-solid fa-qrcode lead"></i><br>
									Créer un code</a>

							</div>
						</div>
					</li>
				{% endfor %}
			</ul>
		</div>
	</div>
</div>

<div id="email-csv" class="modal-container flex justify-around">
	<div class="modal-popup">
		<button class="close-popup">x</button>
		<div class="flex justify-center">
			<div class="basis-10/12">
				{{ form_start(form, {"method": "POST"}) }}
				<h6 id="form-title" class="my-4">Choisir un fichier CSV contenant des mails.</h6>
				<div id="form-fields">
					{{ form_row(form.csvFile) }}
				</div>
					<button type="submit" class="submit-modal w-full">Traiter</button>
				{{ form_widget(form._token) }}
				{{ form_end(form, {'render_rest': false}) }}
			</div>
		</div>
	</div>
</div>{% endblock %}
